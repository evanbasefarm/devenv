{

	"variables": {
		"currentuser": "{{env `USER`}}"
	},

	"builders": [{
		"type": "docker",
		"image": "ubuntu",
		"commit": true,
		"pull": true,
		"volumes": {
			"/home/evan/code": "/tmp/code:ro"
		}
	}],

	"provisioners": [{
		"type": "shell",
		"inline": [
			"apt update",
			"apt install -y curl nano unzip wget openssl python python-pip",
			"pip install awscli --upgrade",
			"wget https://releases.hashicorp.com/terraform/0.11.8/terraform_0.11.8_linux_amd64.zip",
			"wget https://raw.githubusercontent.com/basefarm/aws-session-tool/master/session-tool.sh",
			"unzip terraform_0.11.8_linux_amd64.zip",
			"mv terraform session-tool.sh /usr/local/bin/",
			"echo 'source session-tool.sh' >>~/.profile",
			"rm terraform_0.11.8_linux_amd64.zip",
                        "source ~/.profile"
		]
	}],

	"post-processors": [
		[{
			"type": "docker-tag",
			"repository": "{{user `currentuser`}}",
			"tag": "aws-dev"
		}]
	]

}
